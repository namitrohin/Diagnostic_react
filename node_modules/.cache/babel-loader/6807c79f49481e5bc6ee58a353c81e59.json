{"ast":null,"code":"import _defineProperty from\"F:/React code/diagnostic/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _toConsumableArray from\"F:/React code/diagnostic/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _regeneratorRuntime from\"F:/React code/diagnostic/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _objectSpread from\"F:/React code/diagnostic/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _asyncToGenerator from\"F:/React code/diagnostic/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"F:/React code/diagnostic/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{TextField,Button}from\"@material-ui/core\";import{Autocomplete}from\"@material-ui/lab\";import{DatePicker}from\"@material-ui/pickers\";import React,{useEffect,useState}from\"react\";import SimpleReactValidator from\"simple-react-validator\";import{showErrorToast,showSuccessToast}from\"../../../components/common\";import{CommonController}from\"../../../_redux/controller/common.controller\";import{SimpleTable}from\"../../../components/basic-table\";import useForceUpdate from\"use-force-update\";import moment from\"moment\";import{useSelector}from\"react-redux\";import{Loader}from\"../../../components/loader\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var AddComboMLFB=function AddComboMLFB(_ref){var onClose=_ref.onClose;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),loading=_useState2[0],setLoading=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),dataLoading=_useState4[0],setDataLoading=_useState4[1];var _useState5=useState(new SimpleReactValidator()),_useState6=_slicedToArray(_useState5,2),validator=_useState6[0],setValidator=_useState6[1];var selectedComboMLFBIdResponse=useSelector(function(state){return state.AllReducersMaster.comboMLFBId;});var forceUpdate=useForceUpdate();var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),mlfbProductList=_useState8[0],setProductList=_useState8[1];var _useState9=useState({tran_id:\"0\",date:null,product_id:\"\",remarks:\"\",user_id:localStorage.getItem(\"userId\"),user_name:localStorage.getItem(\"userName\"),mlfbItems:[]}),_useState10=_slicedToArray(_useState9,2),insertParams=_useState10[0],setInsertParams=_useState10[1];var _useState11=useState({date:null,selectedProduct:\"\",selectedMlfb:\"\"}),_useState12=_slicedToArray(_useState11,2),selectedParams=_useState12[0],setSelectedParams=_useState12[1];useEffect(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(selectedComboMLFBIdResponse&&mlfbProductList.length>0)){_context.next=5;break;}setDataLoading(true);_context.next=4;return CommonController.commonApiCallFilter(\"ComboMlfb/ComboMlfbPreview\",{tran_id:selectedComboMLFBIdResponse}).then(function(data){setSelectedParams(_objectSpread(_objectSpread({},selectedParams),{},{date:new Date(data.date.split(\"/\")[1]+\"/\"+data.date.split(\"/\")[0]+\"/\"+data.date.split(\"/\")[2]),selectedMlfb:mlfbProductList.filter(function(x){return x.value===data.mlfb_no;})[0]}));setInsertParams(_objectSpread(_objectSpread({},insertParams),{},{remarks:data.remarks,product_id:data.product_id,mlfbItems:data.mlfbItems,date:data.date,tran_id:data.tran_id}));});case 4:setDataLoading(false);case 5:case\"end\":return _context.stop();}}},_callee);})),[selectedComboMLFBIdResponse,mlfbProductList]);var onProductChoose=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var tempList,indx,_selectedParams$selec2;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:tempList=_toConsumableArray(insertParams.mlfbItems);indx=tempList.findIndex(function(x){var _selectedParams$selec;return x.product_id===((_selectedParams$selec=selectedParams.selectedProduct)===null||_selectedParams$selec===void 0?void 0:_selectedParams$selec.id);});if(!(indx>-1)){_context2.next=6;break;}showErrorToast(\"Already selected\");_context2.next=12;break;case 6:setLoading(true);_context2.next=9;return CommonController.commonApiCallFilter(\"ComboMlfb/ComboMlfbPreviewDetails\",{product_id:(_selectedParams$selec2=selectedParams.selectedProduct)===null||_selectedParams$selec2===void 0?void 0:_selectedParams$selec2.id}).then(function(data){tempList.push(data);});case 9:setInsertParams(_objectSpread(_objectSpread({},insertParams),{},{mlfbItems:tempList}));setLoading(false);setSelectedParams(_objectSpread(_objectSpread({},selectedParams),{},{selectedProduct:\"\"}));case 12:case\"end\":return _context2.stop();}}},_callee2);}));return function onProductChoose(){return _ref3.apply(this,arguments);};}();var insertCombo=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:if(validator.allValid()){if(insertParams.mlfbItems.length>0){CommonController.commonApiCallFilter(\"ComboMlfb/ComboMlfbInsert\",insertParams).then(function(data){if(data.valid){showSuccessToast(\"Successfully Saved\");}else{showErrorToast(\"Something went wrong\");}});}else{showErrorToast(\"Please select MLFB Products\");}}else{validator.showMessages();// rerender to show messages for the first time\n// you can use the autoForceUpdate option to do this automatically`\nforceUpdate();}case 1:case\"end\":return _context3.stop();}}},_callee3);}));return function insertCombo(){return _ref4.apply(this,arguments);};}();var getProductList=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return CommonController.commonApiCallFilter(\"Dropdown/GetProductMlfb\",{}).then(function(data){return setProductList(data);});case 2:case\"end\":return _context4.stop();}}},_callee4);}));return function getProductList(){return _ref5.apply(this,arguments);};}();useEffect(function(){getProductList();},[]);//   const handleDataChange = () => {};\nvar handleDateChange=function handleDateChange(key,date){setInsertParams(_objectSpread(_objectSpread({},insertParams),{},_defineProperty({},key,moment(date).format(\"DD-MM-YYYY\"))));setSelectedParams(_objectSpread(_objectSpread({},selectedParams),{},{date:date}));};var mlfbColumns=[{id:\"mlfb_no\",label:\"MLFB No\"},{id:\"product_code\",label:\"Product Code\"},{id:\"category_name\",label:\"Category Name\"},{id:\"p_group_name\",label:\"Group Name\"}];var handleDelete=function handleDelete(row){var tempList=_toConsumableArray(insertParams.mlfbItems);var indx=tempList.findIndex(function(x){return x.product_id===row.product_id;});if(indx>-1){tempList.splice(indx,1);}setInsertParams(_objectSpread(_objectSpread({},insertParams),{},{mlfbItems:tempList}));};return/*#__PURE__*/_jsxs(\"div\",{className:\"container-fluid mt-5 pt-5\",children:[dataLoading&&/*#__PURE__*/_jsx(Loader,{}),/*#__PURE__*/_jsxs(\"div\",{className:\"row\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-3\",children:[/*#__PURE__*/_jsx(DatePicker,{label:\"Date*\",value:selectedParams.date,format:\"dd-MM-yyyy\",onChange:function onChange(date){handleDateChange(\"date\",date);setSelectedParams(_objectSpread(_objectSpread({},selectedParams),{},{date:date}));},animateYearScrolling:true,inputVariant:\"outlined\",size:\"small\",fullWidth:true}),/*#__PURE__*/_jsx(\"p\",{className:\"text-danger\",children:validator.message(\"Date\",selectedParams.date,\"required\")})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-3\",children:[/*#__PURE__*/_jsx(Autocomplete,{disablePortal:true,id:\"combo-box-demo\",options:mlfbProductList,getOptionLabel:function getOptionLabel(options){return options.value;},fullWidth:true,value:selectedParams.selectedMlfb,onChange:function onChange(event,newValue){setInsertParams(_objectSpread(_objectSpread({},insertParams),{},{product_id:newValue===null||newValue===void 0?void 0:newValue.id}));setSelectedParams(_objectSpread(_objectSpread({},selectedParams),{},{selectedMlfb:newValue}));},size:\"small\",renderInput:function renderInput(params){return/*#__PURE__*/_jsx(TextField,_objectSpread(_objectSpread({variant:\"outlined\",size:\"small\"},params),{},{label:\"MLFB No.*\"}));}}),/*#__PURE__*/_jsx(\"p\",{className:\"text-danger\",children:validator.message(\"MLFB\",insertParams.product_id,\"required\")})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-6\",children:[/*#__PURE__*/_jsx(TextField,{variant:\"outlined\",fullWidth:true,size:\"small\",multiline:true,label:\"Remarks\",value:insertParams.remarks,onChange:function onChange(event){setInsertParams(_objectSpread(_objectSpread({},insertParams),{},{remarks:event.target.value}));}}),/*#__PURE__*/_jsx(\"p\",{className:\"text-danger\",children:validator.message(\"Remarks\",insertParams.remarks,\"required\")})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-4 d-flex\",children:[/*#__PURE__*/_jsx(Autocomplete,{disablePortal:true,id:\"combo-box-demo2\",options:mlfbProductList,getOptionLabel:function getOptionLabel(options){return options.value;},fullWidth:true,value:selectedParams.selectedProduct,onChange:function onChange(event,newValue){setSelectedParams(_objectSpread(_objectSpread({},selectedParams),{},{selectedProduct:newValue}));},size:\"small\",className:\"mr-3\",renderInput:function renderInput(params){return/*#__PURE__*/_jsx(TextField,_objectSpread(_objectSpread({variant:\"outlined\",size:\"small\"},params),{},{label:\"MLFB Product\"}));}}),/*#__PURE__*/_jsx(Button,{color:\"primary\",disabled:loading,onClick:onProductChoose,disableElevation:true,variant:\"contained\",children:loading?/*#__PURE__*/_jsx(\"i\",{class:\"fas fa-circle-notch fa-spin text-white\"}):\"Add\"})]})]}),/*#__PURE__*/_jsx(SimpleTable,{columns:mlfbColumns,rows:insertParams.mlfbItems,onDelete:handleDelete}),/*#__PURE__*/_jsxs(\"div\",{className:\"w-100 text-right mt-4\",children:[/*#__PURE__*/_jsx(Button,{variant:\"contained\",className:\"mr-2\",color:\"primary\",disableElevation:true,onClick:insertCombo,children:\"Save\"}),/*#__PURE__*/_jsx(Button,{onClick:function onClick(){return onClose();},variant:\"contained\",color:\"primary\",disableElevation:true,children:\"Cancel\"})]})]});};export default AddComboMLFB;","map":{"version":3,"sources":["F:/React code/diagnostic/src/pages/Master/combomlfb/addCombo.js"],"names":["TextField","Button","Autocomplete","DatePicker","React","useEffect","useState","SimpleReactValidator","showErrorToast","showSuccessToast","CommonController","SimpleTable","useForceUpdate","moment","useSelector","Loader","AddComboMLFB","onClose","loading","setLoading","dataLoading","setDataLoading","validator","setValidator","selectedComboMLFBIdResponse","state","AllReducersMaster","comboMLFBId","forceUpdate","mlfbProductList","setProductList","tran_id","date","product_id","remarks","user_id","localStorage","getItem","user_name","mlfbItems","insertParams","setInsertParams","selectedProduct","selectedMlfb","selectedParams","setSelectedParams","length","commonApiCallFilter","then","data","Date","split","filter","x","value","mlfb_no","onProductChoose","tempList","indx","findIndex","id","push","insertCombo","allValid","valid","showMessages","getProductList","handleDateChange","key","format","mlfbColumns","label","handleDelete","row","splice","message","options","event","newValue","params","target"],"mappings":"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","sourcesContent":["import { TextField, Button } from \"@material-ui/core\";\nimport { Autocomplete } from \"@material-ui/lab\";\nimport { DatePicker } from \"@material-ui/pickers\";\nimport React, { useEffect, useState } from \"react\";\nimport SimpleReactValidator from \"simple-react-validator\";\nimport { showErrorToast, showSuccessToast } from \"../../../components/common\";\nimport { CommonController } from \"../../../_redux/controller/common.controller\";\nimport { SimpleTable } from \"../../../components/basic-table\";\nimport useForceUpdate from \"use-force-update\";\nimport moment from \"moment\";\nimport { useSelector } from \"react-redux\";\nimport { Loader } from \"../../../components/loader\";\n\nconst AddComboMLFB = ({ onClose }) => {\n  const [loading, setLoading] = useState(false);\n  const [dataLoading, setDataLoading] = useState(false);\n  const [validator, setValidator] = useState(new SimpleReactValidator());\n  const selectedComboMLFBIdResponse = useSelector(\n    (state) => state.AllReducersMaster.comboMLFBId\n  );\n\n  const forceUpdate = useForceUpdate();\n  const [mlfbProductList, setProductList] = useState([]);\n  const [insertParams, setInsertParams] = useState({\n    tran_id: \"0\",\n    date: null,\n    product_id: \"\",\n    remarks: \"\",\n    user_id: localStorage.getItem(\"userId\"),\n    user_name: localStorage.getItem(\"userName\"),\n    mlfbItems: [],\n  });\n\n  const [selectedParams, setSelectedParams] = useState({\n    date: null,\n    selectedProduct: \"\",\n    selectedMlfb: \"\",\n  });\n\n  useEffect(async () => {\n    if (selectedComboMLFBIdResponse && mlfbProductList.length > 0) {\n      setDataLoading(true);\n      await CommonController.commonApiCallFilter(\"ComboMlfb/ComboMlfbPreview\", {\n        tran_id: selectedComboMLFBIdResponse,\n      }).then((data) => {\n        setSelectedParams({\n          ...selectedParams,\n          date: new Date(\n            data.date.split(\"/\")[1] +\n              \"/\" +\n              data.date.split(\"/\")[0] +\n              \"/\" +\n              data.date.split(\"/\")[2]\n          ),\n          selectedMlfb: mlfbProductList.filter(\n            (x) => x.value === data.mlfb_no\n          )[0],\n        });\n        setInsertParams({\n          ...insertParams,\n          remarks: data.remarks,\n          product_id: data.product_id,\n          mlfbItems: data.mlfbItems,\n          date: data.date,\n          tran_id: data.tran_id,\n        });\n      });\n      setDataLoading(false);\n    }\n  }, [selectedComboMLFBIdResponse, mlfbProductList]);\n\n  const onProductChoose = async () => {\n    const tempList = [...insertParams.mlfbItems];\n    const indx = tempList.findIndex(\n      (x) => x.product_id === selectedParams.selectedProduct?.id\n    );\n    if (indx > -1) {\n      showErrorToast(\"Already selected\");\n    } else {\n      setLoading(true);\n      await CommonController.commonApiCallFilter(\n        \"ComboMlfb/ComboMlfbPreviewDetails\",\n        {\n          product_id: selectedParams.selectedProduct?.id,\n        }\n      ).then((data) => {\n        tempList.push(data);\n      });\n      setInsertParams({ ...insertParams, mlfbItems: tempList });\n      setLoading(false);\n      setSelectedParams({ ...selectedParams, selectedProduct: \"\" });\n    }\n  };\n\n  const insertCombo = async () => {\n    if (validator.allValid()) {\n      if (insertParams.mlfbItems.length > 0) {\n        CommonController.commonApiCallFilter(\n          \"ComboMlfb/ComboMlfbInsert\",\n          insertParams\n        ).then((data) => {\n          if (data.valid) {\n            showSuccessToast(\"Successfully Saved\");\n          } else {\n            showErrorToast(\"Something went wrong\");\n          }\n        });\n      } else {\n        showErrorToast(\"Please select MLFB Products\");\n      }\n    } else {\n      validator.showMessages();\n      // rerender to show messages for the first time\n      // you can use the autoForceUpdate option to do this automatically`\n      forceUpdate();\n    }\n  };\n\n  const getProductList = async () => {\n    await CommonController.commonApiCallFilter(\n      \"Dropdown/GetProductMlfb\",\n      {}\n    ).then((data) => setProductList(data));\n  };\n\n  useEffect(() => {\n    getProductList();\n  }, []);\n\n  //   const handleDataChange = () => {};\n\n  const handleDateChange = (key, date) => {\n    setInsertParams({\n      ...insertParams,\n      [key]: moment(date).format(\"DD-MM-YYYY\"),\n    });\n    setSelectedParams({ ...selectedParams, date: date });\n  };\n\n  const mlfbColumns = [\n    {\n      id: \"mlfb_no\",\n      label: \"MLFB No\",\n    },\n    {\n      id: \"product_code\",\n      label: \"Product Code\",\n    },\n    {\n      id: \"category_name\",\n      label: \"Category Name\",\n    },\n    {\n      id: \"p_group_name\",\n      label: \"Group Name\",\n    },\n  ];\n\n  const handleDelete = (row) => {\n    const tempList = [...insertParams.mlfbItems];\n    const indx = tempList.findIndex((x) => x.product_id === row.product_id);\n    if (indx > -1) {\n      tempList.splice(indx, 1);\n    }\n    setInsertParams({ ...insertParams, mlfbItems: tempList });\n  };\n\n  return (\n    <div className=\"container-fluid mt-5 pt-5\">\n      {dataLoading && <Loader />}\n      <div className=\"row\">\n        <div className=\"col-md-3\">\n          <DatePicker\n            label=\"Date*\"\n            value={selectedParams.date}\n            format=\"dd-MM-yyyy\"\n            onChange={(date) => {\n              handleDateChange(\"date\", date);\n              setSelectedParams({ ...selectedParams, date: date });\n            }}\n            animateYearScrolling\n            inputVariant=\"outlined\"\n            size=\"small\"\n            fullWidth\n          />\n          <p className=\"text-danger\">\n            {validator.message(\"Date\", selectedParams.date, \"required\")}\n          </p>\n        </div>\n        <div className=\"col-md-3\">\n          <Autocomplete\n            disablePortal\n            id=\"combo-box-demo\"\n            options={mlfbProductList}\n            getOptionLabel={(options) => options.value}\n            fullWidth\n            value={selectedParams.selectedMlfb}\n            onChange={(event, newValue) => {\n              setInsertParams({ ...insertParams, product_id: newValue?.id });\n              setSelectedParams({ ...selectedParams, selectedMlfb: newValue });\n            }}\n            size=\"small\"\n            renderInput={(params) => (\n              <TextField\n                variant=\"outlined\"\n                size=\"small\"\n                {...params}\n                label=\"MLFB No.*\"\n              />\n            )}\n          />\n          <p className=\"text-danger\">\n            {validator.message(\"MLFB\", insertParams.product_id, \"required\")}\n          </p>\n        </div>\n        <div className=\"col-md-6\">\n          <TextField\n            variant=\"outlined\"\n            fullWidth\n            size=\"small\"\n            multiline\n            label=\"Remarks\"\n            value={insertParams.remarks}\n            onChange={(event) => {\n              setInsertParams({ ...insertParams, remarks: event.target.value });\n            }}\n          />\n          <p className=\"text-danger\">\n            {validator.message(\"Remarks\", insertParams.remarks, \"required\")}\n          </p>\n        </div>\n        <div className=\"col-md-4 d-flex\">\n          <Autocomplete\n            disablePortal\n            id=\"combo-box-demo2\"\n            options={mlfbProductList}\n            getOptionLabel={(options) => options.value}\n            fullWidth\n            value={selectedParams.selectedProduct}\n            onChange={(event, newValue) => {\n              setSelectedParams({\n                ...selectedParams,\n                selectedProduct: newValue,\n              });\n            }}\n            size=\"small\"\n            className=\"mr-3\"\n            renderInput={(params) => (\n              <TextField\n                variant=\"outlined\"\n                size=\"small\"\n                {...params}\n                label=\"MLFB Product\"\n              />\n            )}\n          />\n\n          <Button\n            color=\"primary\"\n            disabled={loading}\n            onClick={onProductChoose}\n            disableElevation\n            variant=\"contained\"\n          >\n            {loading ? (\n              <i class=\"fas fa-circle-notch fa-spin text-white\"></i>\n            ) : (\n              \"Add\"\n            )}\n          </Button>\n        </div>\n      </div>\n      <SimpleTable\n        columns={mlfbColumns}\n        rows={insertParams.mlfbItems}\n        onDelete={handleDelete}\n      />\n      <div className=\"w-100 text-right mt-4\">\n        <Button\n          variant=\"contained\"\n          className=\"mr-2\"\n          color=\"primary\"\n          disableElevation\n          onClick={insertCombo}\n        >\n          Save\n        </Button>\n        <Button\n          onClick={() => onClose()}\n          variant=\"contained\"\n          color=\"primary\"\n          disableElevation\n        >\n          Cancel\n        </Button>\n      </div>\n    </div>\n  );\n};\n\nexport default AddComboMLFB;\n"]},"metadata":{},"sourceType":"module"}