{"ast":null,"code":"import _defineProperty from\"F:/React code/diagnostic/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _regeneratorRuntime from\"F:/React code/diagnostic/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"F:/React code/diagnostic/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _objectSpread from\"F:/React code/diagnostic/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"F:/React code/diagnostic/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{Button,MenuItem,TextField}from\"@material-ui/core\";import React,{useEffect,useState}from\"react\";import{useDispatch,useSelector}from\"react-redux\";import{buttonLoader,showErrorToast,showSuccessToast}from\"../../../components/common\";import{getUserFilterList,getUserRightList}from\"../../../_redux/actions/common.action\";import{CommonController}from\"../../../_redux/controller/common.controller\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var AddSupportTicket=function AddSupportTicket(){var dispatch=useDispatch();var _useState=useState(false),_useState2=_slicedToArray(_useState,2),loading=_useState2[0],setLoading=_useState2[1];var _useState3=useState({}),_useState4=_slicedToArray(_useState3,2),errors=_useState4[0],setErrors=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),userRightListArr=_useState6[0],setUserRightList=_useState6[1];var getuserRightListResponse=useSelector(function(state){return state.common.userRightList;});var _useState7=useState({attach_file:null,attach_file1:null,attach_file2:null}),_useState8=_slicedToArray(_useState7,2),attachments=_useState8[0],setAttachments=_useState8[1];var _useState9=useState([]),_useState10=_slicedToArray(_useState9,2),subMenuList=_useState10[0],setSubMenuList=_useState10[1];useEffect(function(){dispatch(getUserRightList());// dispatch(getUserFilterList());\n},[]);var groupBy=function groupBy(array,key){// Return the end result\nreturn array.reduce(function(result,currentValue){// If an array already present for key, push it to the array. Else create an array and push the object\n(result[currentValue[key]]=result[currentValue[key]]||[]).push(currentValue);// Return the current iteration `result` value, this will be taken as next iteration `result` value and accumulate\nreturn result;},{});// empty object is the initial value for result object\n};useEffect(function(){if(getuserRightListResponse.length>0){var groupedMenu=groupBy(getuserRightListResponse,\"group_name\");setUserRightList(getuserRightListResponse);}},[getuserRightListResponse]);var handleMenuChange=function handleMenuChange(id){var tempMenuIndex=userRightListArr.findIndex(function(x){return x.menu_id===id;});if(tempMenuIndex>-1){setSubMenuList(userRightListArr[tempMenuIndex].transaction_lst);}setFormData(_objectSpread(_objectSpread({},formData),{},{menu:userRightListArr[tempMenuIndex].menu_id,menu_name:userRightListArr[tempMenuIndex].menu_name}));};var _useState11=useState({tran_id:\"\",ticket_no:\"\",date:\"\",menu:\"\",menu_name:\"\",transaction:\"\",type:\"\",priority:\"\",details:\"\",attach_file:\"\",attach_file1:\"\",attach_file2:\"\",user_id:localStorage.getItem(\"userId\")}),_useState12=_slicedToArray(_useState11,2),formData=_useState12[0],setFormData=_useState12[1];var date=formData.date,ticket_no=formData.ticket_no,menu=formData.menu,transaction=formData.transaction,details=formData.details,type=formData.type,priority=formData.priority;useEffect(function(){getSupportTicketData();},[]);var getSupportTicketData=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return CommonController.commonApiCallFilter(\"Ticket/SupportTicketPreview\",formData,\"post\").then(function(data){setFormData(_objectSpread(_objectSpread({},formData),{},{date:data.date,ticket_no:data.ticket_no}));});case 3:_context.next=8;break;case 5:_context.prev=5;_context.t0=_context[\"catch\"](0);showErrorToast(_context.t0);case 8:case\"end\":return _context.stop();}}},_callee,null,[[0,5]]);}));return function getSupportTicketData(){return _ref.apply(this,arguments);};}();var handleFormData=function handleFormData(event){setFormData(_objectSpread(_objectSpread({},formData),{},_defineProperty({},event.target.name,event.target.value)));};var handleFileChange=function handleFileChange(e){if(e.target.files.length>0){setAttachments(_objectSpread(_objectSpread({},attachments),{},_defineProperty({},e.target.name,e.target.files[0])));setFormData(_objectSpread(_objectSpread({},formData),{},_defineProperty({},e.target.name,e.target.files[0].name)));}else{setAttachments(_objectSpread(_objectSpread({},attachments),{},_defineProperty({},e.target.name,null)));setFormData(_objectSpread(_objectSpread({},formData),{},_defineProperty({},e.target.name,\"\")));}};var generateTicket=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var formdata,key;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;if(!validateForm()){_context2.next=8;break;}formdata=new FormData();for(key in attachments){if(attachments.hasOwnProperty(key)&&attachments[key]){formdata.append(key,attachments[key]);}}_context2.next=6;return CommonController.commonApiFile(\"Ticket/TicketImageInsert\",formdata);case 6:_context2.next=8;return CommonController.commonApiCallFilter(\"Ticket/SupportTicketInsert\",formData).then(function(data){if(data.valid){showSuccessToast(\"Ticket Generated Successfully\");}else{showErrorToast(data.msg);}});case 8:_context2.next=13;break;case 10:_context2.prev=10;_context2.t0=_context2[\"catch\"](0);showErrorToast(_context2.t0);case 13:case\"end\":return _context2.stop();}}},_callee2,null,[[0,10]]);}));return function generateTicket(){return _ref2.apply(this,arguments);};}();var validateForm=function validateForm(){var errors={};if(formData.menu==\"\"){errors.menu=\"Menu required\";}else{delete errors.menu;}console.log(formData.type);if(formData.type==\"\"){errors.type=\"Type required\";}else{delete errors.type;}var valid=Object.keys(errors).length===0?true:false;setErrors(errors);return valid;};return/*#__PURE__*/_jsx(\"div\",{className:\"container-fluid mt-5\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"row\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"col-md-4 mb-5\",children:/*#__PURE__*/_jsx(TextField,{fullWidth:true,id:\"outlined-basic\",disabled:true,size:\"small\",name:\"date\",label:\"Date\",variant:\"outlined\",value:date,onChange:handleFormData})}),/*#__PURE__*/_jsx(\"div\",{className:\"col-md-4  mb-5\",children:/*#__PURE__*/_jsx(TextField,{fullWidth:true,id:\"outlined-basic\",size:\"small\",name:\"ticket_no\",label:\"Ticket No\",disabled:true,variant:\"outlined\",value:ticket_no,onChange:handleFormData})}),/*#__PURE__*/_jsx(\"div\",{className:\"col-md-4  mb-5\",children:/*#__PURE__*/_jsx(TextField,{fullWidth:true,id:\"outlined-basic\",size:\"small\",name:\"generated_by\",disabled:true,label:\"Generated By\",value:localStorage.getItem(\"userName\"),variant:\"outlined\",onChange:handleFormData})}),/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-3  mb-5\",children:[/*#__PURE__*/_jsxs(TextField,{fullWidth:true,id:\"outlined-basic\",size:\"small\",name:\"menu\",select:true,label:\"Menu*\",value:menu,variant:\"outlined\",onChange:function onChange(e){handleMenuChange(e.target.value);},children:[/*#__PURE__*/_jsx(MenuItem,{value:\"\",children:\"None\"}),userRightListArr.length>0&&userRightListArr.map(function(menu,index){return/*#__PURE__*/_jsx(MenuItem,{value:menu.menu_id,children:menu.menu_name},index);})]}),errors.menu&&/*#__PURE__*/_jsx(\"p\",{className:\"text-danger mb-0\",children:errors.menu})]}),/*#__PURE__*/_jsx(\"div\",{className:\"col-md-3  mb-5\",children:/*#__PURE__*/_jsx(TextField,{fullWidth:true,id:\"outlined-basic\",size:\"small\",name:\"transaction\",select:true,label:\"Transaction\",value:transaction,variant:\"outlined\",onChange:handleFormData,children:subMenuList.length>0&&subMenuList.map(function(transaction,index){return/*#__PURE__*/_jsx(MenuItem,{value:transaction.transaction_name,children:transaction.transaction_name},index);})})}),/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-3  mb-5\",children:[/*#__PURE__*/_jsxs(TextField,{fullWidth:true,id:\"outlined-basic\",size:\"small\",name:\"type\",select:true,label:\"Type*\",value:type,variant:\"outlined\",onChange:handleFormData,children:[/*#__PURE__*/_jsx(MenuItem,{value:\"New Development\",children:\"New Development\"}),/*#__PURE__*/_jsx(MenuItem,{value:\"Modification\",children:\"Modification\"}),/*#__PURE__*/_jsx(MenuItem,{value:\"Problem\",children:\"Problem\"}),/*#__PURE__*/_jsx(MenuItem,{value:\"Other\",children:\"Other\"})]}),errors.type&&/*#__PURE__*/_jsx(\"p\",{className:\"text-danger mb-0\",children:errors.type})]}),/*#__PURE__*/_jsx(\"div\",{className:\"col-md-3  mb-5\",children:/*#__PURE__*/_jsxs(TextField,{fullWidth:true,id:\"outlined-basic\",size:\"small\",name:\"priority\",select:true,label:\"Priority\",variant:\"outlined\",value:priority,onChange:handleFormData,children:[/*#__PURE__*/_jsx(MenuItem,{value:\"High\",children:\"High\"}),/*#__PURE__*/_jsx(MenuItem,{value:\"Medium\",children:\"Medium\"}),/*#__PURE__*/_jsx(MenuItem,{value:\"Low\",children:\"Low\"})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"col-md-12  mb-5\",children:/*#__PURE__*/_jsx(TextField,{fullWidth:true,id:\"outlined-basic\",size:\"small\",name:\"details\",multiline:true,label:\"Details\",value:details,onChange:handleFormData,variant:\"outlined\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"col-md-1\",children:/*#__PURE__*/_jsx(\"label\",{className:\"font-weight-bold\",children:\"Attachment\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"col-md-3\",children:/*#__PURE__*/_jsx(\"input\",{type:\"file\",name:\"attach_file\",onChange:handleFileChange,className:\"form-control\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"col-md-3\",children:/*#__PURE__*/_jsx(\"input\",{type:\"file\",name:\"attach_file1\",onChange:handleFileChange,className:\"form-control\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"col-md-3\",children:/*#__PURE__*/_jsx(\"input\",{type:\"file\",name:\"attach_file2\",onChange:handleFileChange,className:\"form-control\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-12 mt-5 text-right\",children:[/*#__PURE__*/_jsx(Button,{variant:\"contained\",className:\"mr-2\",color:\"primary\",disableElevation:true,children:\"Cancel\"}),buttonLoader(loading,\"Save\",generateTicket,\"primary\")]})]})});};export default AddSupportTicket;","map":{"version":3,"sources":["F:/React code/diagnostic/src/pages/support/ticket/addTicket.js"],"names":["Button","MenuItem","TextField","React","useEffect","useState","useDispatch","useSelector","buttonLoader","showErrorToast","showSuccessToast","getUserFilterList","getUserRightList","CommonController","AddSupportTicket","dispatch","loading","setLoading","errors","setErrors","userRightListArr","setUserRightList","getuserRightListResponse","state","common","userRightList","attach_file","attach_file1","attach_file2","attachments","setAttachments","subMenuList","setSubMenuList","groupBy","array","key","reduce","result","currentValue","push","length","groupedMenu","handleMenuChange","id","tempMenuIndex","findIndex","x","menu_id","transaction_lst","setFormData","formData","menu","menu_name","tran_id","ticket_no","date","transaction","type","priority","details","user_id","localStorage","getItem","getSupportTicketData","commonApiCallFilter","then","data","handleFormData","event","target","name","value","handleFileChange","e","files","generateTicket","validateForm","formdata","FormData","hasOwnProperty","append","commonApiFile","valid","msg","console","log","Object","keys","map","index","transaction_name"],"mappings":"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","sourcesContent":["import { Button, MenuItem, TextField } from \"@material-ui/core\";\nimport React, { useEffect, useState } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport {\n  buttonLoader,\n  showErrorToast,\n  showSuccessToast,\n} from \"../../../components/common\";\nimport {\n  getUserFilterList,\n  getUserRightList,\n} from \"../../../_redux/actions/common.action\";\nimport { CommonController } from \"../../../_redux/controller/common.controller\";\n\nconst AddSupportTicket = () => {\n  const dispatch = useDispatch();\n  const [loading, setLoading] = useState(false);\n  const [errors, setErrors] = useState({});\n\n  const [userRightListArr, setUserRightList] = useState([]);\n  const getuserRightListResponse = useSelector(\n    (state) => state.common.userRightList\n  );\n\n  const [attachments, setAttachments] = useState({\n    attach_file: null,\n    attach_file1: null,\n    attach_file2: null,\n  });\n\n  const [subMenuList, setSubMenuList] = useState([]);\n\n  useEffect(() => {\n    dispatch(getUserRightList());\n    // dispatch(getUserFilterList());\n  }, []);\n\n  const groupBy = (array, key) => {\n    // Return the end result\n    return array.reduce((result, currentValue) => {\n      // If an array already present for key, push it to the array. Else create an array and push the object\n      (result[currentValue[key]] = result[currentValue[key]] || []).push(\n        currentValue\n      );\n      // Return the current iteration `result` value, this will be taken as next iteration `result` value and accumulate\n      return result;\n    }, {}); // empty object is the initial value for result object\n  };\n\n  useEffect(() => {\n    if (getuserRightListResponse.length > 0) {\n      const groupedMenu = groupBy(getuserRightListResponse, \"group_name\");\n\n      setUserRightList(getuserRightListResponse);\n    }\n  }, [getuserRightListResponse]);\n\n  const handleMenuChange = (id) => {\n    var tempMenuIndex = userRightListArr.findIndex((x) => x.menu_id === id);\n    if (tempMenuIndex > -1) {\n      setSubMenuList(userRightListArr[tempMenuIndex].transaction_lst);\n    }\n    setFormData({\n      ...formData,\n      menu: userRightListArr[tempMenuIndex].menu_id,\n      menu_name: userRightListArr[tempMenuIndex].menu_name,\n    });\n  };\n\n  const [formData, setFormData] = useState({\n    tran_id: \"\",\n    ticket_no: \"\",\n    date: \"\",\n    menu: \"\",\n    menu_name: \"\",\n    transaction: \"\",\n    type: \"\",\n    priority: \"\",\n    details: \"\",\n    attach_file: \"\",\n    attach_file1: \"\",\n    attach_file2: \"\",\n    user_id: localStorage.getItem(\"userId\"),\n  });\n\n  const {\n    date,\n    ticket_no,\n    menu,\n    transaction,\n    details,\n\n    type,\n    priority,\n  } = formData;\n\n  useEffect(() => {\n    getSupportTicketData();\n  }, []);\n\n  const getSupportTicketData = async () => {\n    try {\n      await CommonController.commonApiCallFilter(\n        \"Ticket/SupportTicketPreview\",\n        formData,\n        \"post\"\n      ).then((data) => {\n        setFormData({\n          ...formData,\n          date: data.date,\n          ticket_no: data.ticket_no,\n        });\n      });\n    } catch (err) {\n      showErrorToast(err);\n    }\n  };\n\n  const handleFormData = (event) => {\n    setFormData({ ...formData, [event.target.name]: event.target.value });\n  };\n\n  const handleFileChange = (e) => {\n    if (e.target.files.length > 0) {\n      setAttachments({ ...attachments, [e.target.name]: e.target.files[0] });\n      setFormData({ ...formData, [e.target.name]: e.target.files[0].name });\n    } else {\n      setAttachments({ ...attachments, [e.target.name]: null });\n      setFormData({ ...formData, [e.target.name]: \"\" });\n    }\n  };\n\n  const generateTicket = async () => {\n    try {\n      if (validateForm()) {\n        let formdata = new FormData();\n        for (var key in attachments) {\n          if (attachments.hasOwnProperty(key) && attachments[key]) {\n            formdata.append(key, attachments[key]);\n          }\n        }\n        await CommonController.commonApiFile(\n          \"Ticket/TicketImageInsert\",\n          formdata\n        );\n        await CommonController.commonApiCallFilter(\n          \"Ticket/SupportTicketInsert\",\n          formData\n        ).then((data) => {\n          if (data.valid) {\n            showSuccessToast(\"Ticket Generated Successfully\");\n          } else {\n            showErrorToast(data.msg);\n          }\n        });\n      }\n    } catch (err) {\n      showErrorToast(err);\n    }\n  };\n\n  const validateForm = () => {\n    let errors = {};\n    if (formData.menu == \"\") {\n      errors.menu = \"Menu required\";\n    } else {\n      delete errors.menu;\n    }\n\n    console.log(formData.type);\n    if (formData.type == \"\") {\n      errors.type = \"Type required\";\n    } else {\n      delete errors.type;\n    }\n\n    const valid = Object.keys(errors).length === 0 ? true : false;\n    setErrors(errors);\n    return valid;\n  };\n\n  return (\n    <div className=\"container-fluid mt-5\">\n      <div className=\"row\">\n        <div className=\"col-md-4 mb-5\">\n          <TextField\n            fullWidth\n            id=\"outlined-basic\"\n            disabled\n            size=\"small\"\n            name=\"date\"\n            label=\"Date\"\n            variant=\"outlined\"\n            value={date}\n            onChange={handleFormData}\n          />\n        </div>\n        <div className=\"col-md-4  mb-5\">\n          <TextField\n            fullWidth\n            id=\"outlined-basic\"\n            size=\"small\"\n            name=\"ticket_no\"\n            label=\"Ticket No\"\n            disabled\n            variant=\"outlined\"\n            value={ticket_no}\n            onChange={handleFormData}\n          />\n        </div>\n        <div className=\"col-md-4  mb-5\">\n          <TextField\n            fullWidth\n            id=\"outlined-basic\"\n            size=\"small\"\n            name=\"generated_by\"\n            disabled\n            label=\"Generated By\"\n            value={localStorage.getItem(\"userName\")}\n            variant=\"outlined\"\n            onChange={handleFormData}\n          />\n        </div>\n        <div className=\"col-md-3  mb-5\">\n          <TextField\n            fullWidth\n            id=\"outlined-basic\"\n            size=\"small\"\n            name=\"menu\"\n            select\n            label=\"Menu*\"\n            value={menu}\n            variant=\"outlined\"\n            onChange={(e) => {\n              handleMenuChange(e.target.value);\n            }}\n          >\n            <MenuItem value={\"\"}>None</MenuItem>\n            {userRightListArr.length > 0 &&\n              userRightListArr.map((menu, index) => {\n                return (\n                  <MenuItem key={index} value={menu.menu_id}>\n                    {menu.menu_name}\n                  </MenuItem>\n                );\n              })}\n          </TextField>\n          {errors.menu && <p className=\"text-danger mb-0\">{errors.menu}</p>}\n        </div>\n        <div className=\"col-md-3  mb-5\">\n          <TextField\n            fullWidth\n            id=\"outlined-basic\"\n            size=\"small\"\n            name=\"transaction\"\n            select\n            label=\"Transaction\"\n            value={transaction}\n            variant=\"outlined\"\n            onChange={handleFormData}\n          >\n            {subMenuList.length > 0 &&\n              subMenuList.map((transaction, index) => {\n                return (\n                  <MenuItem key={index} value={transaction.transaction_name}>\n                    {transaction.transaction_name}\n                  </MenuItem>\n                );\n              })}\n          </TextField>\n        </div>\n        <div className=\"col-md-3  mb-5\">\n          <TextField\n            fullWidth\n            id=\"outlined-basic\"\n            size=\"small\"\n            name=\"type\"\n            select\n            label=\"Type*\"\n            value={type}\n            variant=\"outlined\"\n            onChange={handleFormData}\n          >\n            <MenuItem value={\"New Development\"}>New Development</MenuItem>\n            <MenuItem value={\"Modification\"}>Modification</MenuItem>\n            <MenuItem value={\"Problem\"}>Problem</MenuItem>\n            <MenuItem value={\"Other\"}>Other</MenuItem>\n          </TextField>\n          {errors.type && <p className=\"text-danger mb-0\">{errors.type}</p>}\n        </div>\n        <div className=\"col-md-3  mb-5\">\n          <TextField\n            fullWidth\n            id=\"outlined-basic\"\n            size=\"small\"\n            name=\"priority\"\n            select\n            label=\"Priority\"\n            variant=\"outlined\"\n            value={priority}\n            onChange={handleFormData}\n          >\n            <MenuItem value={\"High\"}>High</MenuItem>\n            <MenuItem value={\"Medium\"}>Medium</MenuItem>\n            <MenuItem value={\"Low\"}>Low</MenuItem>\n          </TextField>\n        </div>\n        <div className=\"col-md-12  mb-5\">\n          <TextField\n            fullWidth\n            id=\"outlined-basic\"\n            size=\"small\"\n            name=\"details\"\n            multiline\n            label=\"Details\"\n            value={details}\n            onChange={handleFormData}\n            variant=\"outlined\"\n          />\n        </div>\n        <div className=\"col-md-1\">\n          <label className=\"font-weight-bold\">Attachment</label>\n        </div>\n        <div className=\"col-md-3\">\n          <input\n            type=\"file\"\n            name=\"attach_file\"\n            onChange={handleFileChange}\n            className=\"form-control\"\n          />\n        </div>\n        <div className=\"col-md-3\">\n          <input\n            type=\"file\"\n            name=\"attach_file1\"\n            onChange={handleFileChange}\n            className=\"form-control\"\n          />\n        </div>\n        <div className=\"col-md-3\">\n          <input\n            type=\"file\"\n            name=\"attach_file2\"\n            onChange={handleFileChange}\n            className=\"form-control\"\n          />\n        </div>\n        <div className=\"col-md-12 mt-5 text-right\">\n          <Button\n            variant=\"contained\"\n            className=\"mr-2\"\n            color=\"primary\"\n            disableElevation\n          >\n            Cancel\n          </Button>\n          {buttonLoader(loading, \"Save\", generateTicket, \"primary\")}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default AddSupportTicket;\n"]},"metadata":{},"sourceType":"module"}